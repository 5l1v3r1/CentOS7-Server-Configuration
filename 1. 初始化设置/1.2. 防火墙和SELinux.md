## 1.2. 防火墙和SELinux

### 1.2.1. 防火墙

CentOS7默认使用firewalld防火墙，运行以下命令以查看状态：

`systemctl status firewalld`

firewalld的一些简单配置可以参考[这里](#firewalld：基本操作)

个人习惯使用iptables，按下面步骤操作：

`systemctl stop firewalld` # 停止firewalld

`systemctl disable firewalld` # 取消开机启动

`yum -y install iptables-services` # 安装iptables

编辑`/etc/sysconfig/iptables`文件配置规则

`systemctl restart iptables` # 编辑规则后重启防火墙

`systemctl enable iptables` # 设置开机启动

#### Firewalld：基本操作

服务的定义在Firewalld被设置为区域。要启用防火墙，将区域与相关命令的NIC关联。

要使用Firewalld，先启用：

```
systemctl start firewalld
systemctl enable firewalld
```

默认情况下，“public”区域应用于NIC且dhcpv6-client和ssh是允许的。当使用“firewall-cmd”命令操作时，如果输入命令不带“--zone=***”格式，则配置设置为默认区域。

`firewall-cmd --get-default-zone` # 显示默认区域

```
public
```

`firewall-cmd --list-all` # 显示当前设置

```
public (default, active)
  interfaces: eno16777736
  sources:
  services: dhcpv6-client ssh
  ports:
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:
```

`firewall-cmd --list-all-zones` # 显示默认定义的所有区域

```
block
  interfaces:
  sources:
  services:
  ports:
  masquerade: no
  forward-ports:
  icmp-blocks:
  rich rules:
  .....
  .....
```

`firewall-cmd --list-service --zone=external` # 显示特定区域上允许的服务

```
ssh
```

`firewall-cmd --set-default-zone=external` # 更改默认区域

```
success
```

`firewall-cmd --change-interface=eth1 --zone=external` # 更改接口的区域（“change-interface”不会永久更改，即使添加了“--permanent”选项）

```
success
```

`firewall-cmd --list-all --zone=external`

```
external (active)
  interfaces: eth1
  sources:
  services: ssh
  ports:
  masquerade: yes
  forward-ports:
  icmp-blocks:
  rich rules:
```

如果要永久更改，使用nmcli命令：

`nmcli c mod eth1 connection.zone external`

`firewall-cmd --get-active-zone` # 显示激活的区域

```
external
  interfaces: eth1
public
  interfaces: eth0
```

**显示默认定义的服务：**

`firewall-cmd --get-services`

```
amanda-client bacula bacula-client dhcp dhcpv6 dhcpv6-client dns ftp high-availability http https imaps ipp ipp-client ipsec kerberos kpasswd ldap ldaps libvirt libvirt-tls mdns mountd ms-wbt mysql nfs ntp openvpn pmcd pmproxy pmwebapi pmwebapis pop3s postgresql proxy-dhcp radius rpc-bind samba samba-client smtp ssh telnet tftp tftp-client transmission-client vnc-server wbem-https
```

定义文件放置如下（如果要添加你的原始定义，在这里添加XML文件）：

`ls /usr/lib/firewalld/services`

```
amanda-client.xml      ipp-client.xml   mysql.xml       rpc-bind.xml
bacula-client.xml      ipp.xml          nfs.xml         samba-client.xml
bacula.xml             ipsec.xml        ntp.xml         samba.xml
dhcpv6-client.xml      kerberos.xml     openvpn.xml     smtp.xml
dhcpv6.xml             kpasswd.xml      pmcd.xml        ssh.xml
dhcp.xml               ldaps.xml        pmproxy.xml     telnet.xml
dns.xml                ldap.xml         pmwebapis.xml   tftp-client.xml
ftp.xml                libvirt-tls.xml  pmwebapi.xml    tftp.xml
high-availability.xml  libvirt.xml      pop3s.xml       transmission-client.xml
https.xml              mdns.xml         postgresql.xml  vnc-server.xml
http.xml               mountd.xml       proxy-dhcp.xml  wbem-https.xml
imaps.xml              ms-wbt.xml       radius.xml
```

**添加或删除允许的服务：**

更改将在重新启动系统后恢复。如果要永久更改设置，添加“--permanent”选项。

`firewall-cmd --add-service=http` # 添加http（更改将立即生效）

```
success
```

`firewall-cmd --list-service`

```
dhcpv6-client http ssh
```

`firewall-cmd --remove-service=http` # 删除http

```
success
```

`firewall-cmd --list-service`

```
dhcpv6-client ssh
```

`firewall-cmd --add-service=http --permanent` # 永久添加http（需要重新加载Firewalld以启用更改）

```
success
```

`firewall-cmd --reload` # 重新加载Firewalld

```
success
```

firewall-cmd --list-service

```
dhcpv6-client http ssh
```






### 1.2.2. SELinux

运行以下命令查看状态：

`getenforce`

```
Enforcing  # 表示已启用
```

对SELinux不熟悉的一般推荐禁用：

编辑`/etc/selinux/config`文件，将`SELINUX=`一行改为`SELINUX=disabled`，重启系统后生效。
