## 1.8. 配置NTP

### 1.8.1. 配置NTP服务器

#### 1.8.1.1. NTPd

安装NTPd：

`yum -y install ntp`

编辑`/etc/ntp.conf`文件

添加允许接收请求的网络范围：

`restrict 10.0.0.0 mask 255.255.255.0 nomodify notrap`

更改同步服务器：

```
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst
server 0.cn.pool.ntp.org iburst
server 1.cn.pool.ntp.org iburst
server 2.cn.pool.ntp.org iburst
server 3.cn.pool.ntp.org iburst
```

以上服务器地址可以在<http://www.pool.ntp.org/zh/>查找。

启动并设置开机启动：

```
systemctl start ntpd
systemctl enable ntpd
```

firewalld防火墙设置（NTP使用端口123/UDP）：

```
firewall-cmd --add-service=ntp --permanent
firewall-cmd --reload
```

验证运行：

`ntpq -p`

#### 1.8.1.2. Chrony

与NTPd选择一个安装。

安装：

`yum -y install chrony`

编辑`/etc/chrony.conf`文件

更改同步服务器：

```
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst
server 0.cn.pool.ntp.org iburst
server 1.cn.pool.ntp.org iburst
server 2.cn.pool.ntp.org iburst
server 3.cn.pool.ntp.org iburst
```

添加允许接收请求的网络范围：

`allow 10.0.0.0/24`

启动并设置开机启动：

```
systemctl start chronyd
systemctl enable chronyd
```

防火墙设置同NTPd。

验证运行：

`chronyc sources`

### 1.8.2. 配置NTP客户端

#### 1.8.2.1. CentOS

CentOS的NTP客户端设置大致与服务器相同，参考[NTPd](#1811-ntpd)或[Chrony](#1812-chrony)的设置



















