## 11.1. HAProxy

### 11.1.1. 安装HAProxy

安装[HAProxy](http://www.haproxy.org/)以配置负载均衡服务器。

本例基于以下环境：

![haproxy-environment](../Contents/haproxy-environment.png)

与HAProxy服务器的HTTP连接转发到后端Web服务器。

`yum -y install haproxy`

配置HAProxy：

`mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.org`

编辑`/etc/haproxy/haproxy.cfg`文件：

```
global
    # 用于日志部分
    log         127.0.0.1 local2 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    # 最大每进程连接数
    maxconn     256
    # 进程用户和组
    user        haproxy
    group       haproxy
    # 使进程叉入后台
    daemon

defaults
    # 运行模式
    mode               http
    # 使用全局设置
    log                global
    # 获取HTTP请求日志
    option             httplog
    # 如果后端没有回复，则超时
    timeout connect    10s
    # 客户端超时
    timeout client     30s
    # 服务器端超时
    timeout server     30s

# 定义前端（为“http-in”部分设置任意名称）
frontend http-in
    # 侦听80端口
    bind *:80
    # 设置默认后端
    default_backend    backend_servers
    # 发送X-Forwarded-For头
    option             forwardfor

# 定义后端
backend backend_servers
    # balance with roundrobin
    balance            roundrobin
    # define backend servers
    server             www01 10.0.0.31:80 check
    server             www02 10.0.0.32:80 check
```

















