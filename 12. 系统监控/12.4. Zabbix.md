## 12.4. Zabbix

[Zabbix](http://www.zabbix.com/)是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。

### 12.4.1. 安装Zabbix 3.2

先安装[Apache httpd](../5. Web服务器/5.1. Apache httpd.html)，[PHP](../5. Web服务器/5.1. Apache httpd.html#513-使用php脚本)和[MariaDB](../6. 数据库/6.1. MariaDB.html)。

`yum -y install php-mysql php-gd php-xml php-bcmath` # 安装一些其他必需的软件包

`yum -y install http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm` # 安装Zabbix存储库

`yum -y install zabbix-get zabbix-server-mysql zabbix-web-mysql zabbix-agent` # 安装Zabbix服务器

为Zabbix创建数据库：

`mysql -u root -p`

```
Enter password:
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 5.5.50-MariaDB MariaDB Server

Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> create database zabbix;
Query OK, 1 row affected (0.00 sec)

MariaDB [(none)]> grant all privileges on zabbix.* to zabbix@'localhost' identified by 'password';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> grant all privileges on zabbix.* to zabbix@'%' identified by 'password';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> flush privileges;
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]> exit
Bye
```

`cd /usr/share/doc/zabbix-server-mysql-*/`

`gunzip create.sql.gz`

`mysql -u root -p zabbix < create.sql`

```
Enter password:
```

配置并启动Zabbix服务器：

编辑`/etc/zabbix/zabbix_server.conf`文件：

```
# 添加
DBHost=localhost

# 添加Zabbix数据库密码
DBPassword=password
```

```
systemctl start zabbix-server
systemctl enable zabbix-server
```

配置并启动Zabbix代理以监控Zabbix服务器本身：

编辑`/etc/zabbix/zabbix_agentd.conf`文件：

```
# 指定Zabbix服务器
Server=127.0.0.1

# 指定Zabbix服务器
ServerActive=127.0.0.1

# 更改为自己的主机名
Hostname=dlp.srv.world
```

```
systemctl start zabbix-agent
systemctl enable zabbix-agent
```

编辑`/etc/httpd/conf.d/zabbix.conf`文件，更改httpd设置如下：

```
# 为Zabbix Web前端添加访问权限
#Require all granted
Require ip 127.0.0.1 10.0.0.0/24

# 取消注释并更改为自己的时区
php_value date.timezone Asia/Shanghai
```

`systemctl restart httpd`

如果启用了SELinux，更改布尔设置：

`setsebool -P httpd_can_connect_zabbix on`

firewalld防火墙规则：

```
firewall-cmd --add-service={http,https} --permanent
firewall-cmd --add-port={10051/tcp,10050/tcp} --permanent
firewall-cmd --reload
```

### 12.4.2. 初始设置

从Zabbix服务器允许的网络中的客户端访问`http://(Zabbix服务器的主机名或IP地址)/zabbix/`，显示Zabbix起始页，点击“Next step”继续：

![zabbix-initial-setup1](../Contents/zabbix-initial-setup1.png)










### 12.4.3. 设置监控目标主机
### 12.4.4. 设置电子邮件通知
### 12.4.5. 添加目标主机
### 12.4.6. 添加目标项目














