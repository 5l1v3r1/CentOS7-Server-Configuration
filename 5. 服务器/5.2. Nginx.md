## 5.2. Nginx

### 5.2.1. 安装Nginx

`yum --enablerepo=epel -y install nginx` # 从EPEL安装

配置基本设置，编辑`/etc/nginx/nginx.conf`文件：

```
# 更改主机名
server_name www.srv.world;
```

```
systemctl start nginx
systemctl enable nginx
```

firewalld防火墙设置（HTTP默认端口80/TCP）：

```
firewall-cmd --add-service=http --permanent
firewall-cmd --reload
```

使用Web浏览器从客户端电脑访问Nginx的默认页面，如果显示以下页面，则运行正常：

![nginx-test-page](../Contents/nginx-test-page.png)

### 5.2.2. 虚拟主机

本例配置其他域名为“virtual.host”：

编辑`/etc/nginx/conf.d/virtual.host.conf`文件：

```
server {
    listen       80;
    server_name  www.virtual.host;

    location / {
        root   /usr/share/nginx/virtual.host;
        index  index.html index.htm;
    }
}
```

编辑`/usr/share/nginx/virtual.host/index.html`文件，创建测试页以确保其正常工作：

```
<html>
<body>
<div style="width: 100%; font-size: 40px; font-weight: bold; text-align: center;">
Nginx Virtual Host Test Page
</div>
</body>
</html>
```

![nginx-vhost-test-page](../Contents/nginx-vhost-test-page.png)

### 5.2.3. 启用Userdir

启用普通用户的Userdir在主目录中打开其网站。

编辑`/etc/nginx/nginx.conf`文件：

```
# 在“server”部分添加以下内容
        location ~ ^/~(.+?)(/.*)?$ {
            alias /home/$1/public_html$2;
            index  index.html index.htm;
            autoindex on;
        }
```

`systemctl restart nginx`

使用普通用户创建测试页以确保其正常工作：

```
chmod 711 /home/cent
mkdir ~/public_html
chmod 755 ~/public_html
```

编辑`~/public_html/index.html`文件：

```
<html>
<body>
<div style="width: 100%; font-size: 40px; font-weight: bold; text-align: center;">
Nginx UserDir Test Page
</div>
</body>
</html>
```

![nginx-userdir-test-page](../Contents/nginx-userdir-test-page.png)

### 5.2.4. 配置SSL

配置SSL以使用安全加密连接。

首先[创建证书](../5. 服务器/5.3. 创建SSL证书.html)。

编辑`/etc/nginx/nginx.conf`文件：

```
# 在“server”部分添加以下内容
    server {
        listen       80 default_server;
        listen       [::]:80 default_server;
        listen       443 ssl;
        server_name  www.srv.world;
        root         /usr/share/nginx/html;

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers ECDHE+RSAGCM:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:!aNULL!eNull:!EXPORT:!DES:!3DES:!MD5:!DSS;
        ssl_certificate      /etc/pki/tls/certs/server.crt;
        ssl_certificate_key  /etc/pki/tls/certs/server.key;
```

firewalld防火墙设置（HTTPS默认端口443/TCP）：

```
firewall-cmd --add-service=https --permanent
firewall-cmd --reload
```

使用HTTPS访问默认页面，以确保其正常工作：

![nginx-https-test-page](../Contents/nginx-https-test-page.png)


















