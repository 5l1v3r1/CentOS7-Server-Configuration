## 8.2. Samba

安装[Samba](https://www.samba.org/)以配置文件服务器。

### 8.2.1. 完全访问共享文件夹

本例演示创建一个完全访问的共享文件夹，任何人都可以读取和写入，并且不需要身份验证。

`yum -y install samba samba-client`

`mkdir /home/share`

`chmod 777 /home/share`

编辑`/etc/samba/smb.conf`文件：

```
# 添加如下内容
unix charset = UTF-8
dos charset = CP932

# 如下更改（Windows默认）
workgroup = WORKGROUP

# 取消注释并更改为允许的IP地址
hosts allow = 127. 10.0.0.

# 添加（无验证）
security = user
passdb backend = tdbsam
map to guest = Bad User

# 将以下内容添加到最后
[Share]  # 任意名称
    path = /home/share  # 共享目录
    writable = yes  # 可写
    guest ok = yes  # 允许guest
    guest only = yes  # 仅guest
    create mode = 0777  # 完全访问的文件
    directory mode = 0777  # 完全访问的目录
```

```
systemctl start smb nmb
systemctl enable smb nmb
```

firewalld防火墙规则：

```
setsebool -P samba_enable_home_dirs on
restorecon -R /home/share
```

### 8.2.2. 受限访问的共享文件夹

本例演示创建需要用户身份验证的共享文件夹。

`yum -y install samba samba-client`

`groupadd security`

`mkdir /home/security`

`chgrp security /home/security`

`chmod 770 /home/security`

编辑`/etc/samba/smb.conf`文件：

```
# 添加如下内容
unix charset = UTF-8

# 如下更改（Windows默认）
workgroup = WORKGROUP

# 取消注释并更改为允许的IP地址
hosts allow = 127. 10.0.0.

# 将以下内容添加到最后
[Security]  # 任意名称
    path = /home/security
    writable = yes
    create mode = 0770
    directory mode = 0770
    guest ok = no  # 不允许guest
    valid users = @security  # 仅允许security组
```

```
systemctl start smb nmb
systemctl enable smb nmb
```

在Samba中添加用户：

`smbpasswd -a cent`

```
New SMB password:  # 设置密码
Retype new SMB password:  # 确认密码
Added user cent.
```

`usermod -G security cent`

firewalld防火墙规则：

```
setsebool -P samba_enable_home_dirs on
restorecon -R /home/share
```

如果启用了SELinux：

`setsebool -P samba_enable_home_dirs on`

`restorecon -R /home/security`

### 8.2.3. Samba Winbind

使用Samba Winbind加入Windows Active Directory域。

本教程需要LAN中的Windows Active Directory域服务。

本例演示在以下环境中进行配置：

![samba-winbind-environment](../Contents/samba-winbind-environment.png)

















