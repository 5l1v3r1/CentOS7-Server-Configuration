## 附0.7. 尝试访问次数

如果对用户的尝试访问次数超过该值，则用户帐户将被锁定。

编辑`/etc/pam.d/system-auth`文件：

```
# 添加如下内容
# “deny=N”表示超过N次用户帐户将被锁定（“root”用户未应用）
# 如果要适用于“root”，需添加“even_deny_root”
# “unlock_time=N”表示N秒后锁定的帐户将被解锁（如果没有指定此值，锁定的帐户将不会自动解锁）
# 如果指定“even_deny_root”，可以使用“root_unlock_time=N”指定“root”解锁的时间
auth        required      pam_env.so
auth        required      pam_tally2.so deny=5 unlock_time=60
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid >= 1000 quiet_success
auth        required      pam_deny.so

account     required      pam_unix.so
account     required      pam_tally2.so
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid < 1000 quiet
account     required      pam_permit.so
```

编辑`/etc/pam.d/password-auth`文件：

```
# 添加如下内容
auth        required      pam_env.so
auth        required      pam_tally2.so deny=5 unlock_time=60
auth        sufficient    pam_unix.so nullok try_first_pass
auth        requisite     pam_succeed_if.so uid >= 1000 quiet_success
auth        required      pam_deny.so

account     required      pam_unix.so
account     required      pam_tally2.so
account     sufficient    pam_localuser.so
account     sufficient    pam_succeed_if.so uid < 1000 quiet
account     required      pam_permit.so
```

如下所示查看尝试访问的次数或手动解锁锁定的帐户：

`pam_tally2 -u cent` # 显示尝试访问的次数

```
Login           Failures Latest failure     From
cent                6    07/23/15 19:24:01  ttyS0
```

`pam_tally2 -r -u cent` # 手动解锁锁定的帐户
