## 附1.8. 配置管理工具

### 附1.8.1. Salt

[Salt](https://saltstack.com/community/)是一个强大的远程执行管理器，用于快速和高效的服务器管理。

#### 附1.8.1.1. 安装Salt

可以在独立的服务器上使用Salt，本例演示配置为Server和Client环境。管理服务器称为Salt Master，客户端服务器称为Salt Minion。

在**Salt Master**主机上安装“salt-master”：

`yum --enablerepo=epel -y install salt-master` # 从EPEL安装

```
systemctl start salt-master
systemctl enable salt-master
```

Salt Master防火墙规则：

```
firewall-cmd --add-port={4505/tcp,4506/tcp} --permanent
firewall-cmd --reload
```

在**Salt Minion**主机上安装“salt-minionr”：

`yum --enablerepo=epel -y install salt-minion` # 从EPEL安装

编辑`/etc/salt/minion`文件:

```
# 取消注释并指定Salt Master服务器
master: dlp.srv.world
```

```
systemctl start salt-minion
systemctl enable salt-minion
```

Salt Minion初始运行时，向Salt Master发送公钥认证。如果Salt Master接受密钥，Salt Master和Salt Minion可以互相连接。

**Salt Master**上运行：

`salt-key -L` # 显示密钥列表

```
Accepted Keys:
Denied Keys:
Unaccepted Keys:
node01.srv.world
Rejected Keys:
```

`salt-key -A` # 使用`A`选项允许所有密钥

```
The following keys are going to be accepted:
Unaccepted Keys:
node01.srv.world
Proceed? [n/Y] y
Key for minion node01.srv.world accepted.
```

`salt-key -L`

```
Accepted Keys:
node01.srv.world
Denied Keys:
Unaccepted Keys:
Rejected Keys:
```

`salt "*" test.ping` # 验证工作

```
node01.srv.world:
    True
```

#### 附1.8.1.2. 基本用法

从Salt Master到Salt Minion远程执行命令的基本用法：

`salt [option] [target] [function] [arguments]`

有关所有嵌入式功能的说明，[参阅官方网站](https://docs.saltstack.com/en/latest/ref/modules/all/index.html)。

也可以使用命令查看功能（有多行输出，使用`less`或`more`的命令来读取）：

`salt '*' sys.doc`

```
'acl.delfacl:'

    Remove specific FACL from the specified file(s)

    CLI Examples:

        salt '*' acl.delfacl user myuser /tmp/house/kitchen
        salt '*' acl.delfacl default:group mygroup /tmp/house/kitchen

.....
.....
```

可以用各种方式指定目标：

`salt '*' test.ping` # 指定所有Minion，`test.ping`表示确认Minion是活动的

```
node02.srv.world:
    True
node01.srv.world:
    True
```

`salt 'node01.srv.world' disk.usage` # 指定Minion：“node01.srv.world”，`disk.usage`表示确认当前磁盘使用率

```
node01.srv.world:
    ----------
    /:
        ----------
        1K-blocks:
            27740944
        available:
            26176776
        capacity:
            6%
        filesystem:
            /dev/mapper/centos-root
        used:
            1564168
.....
.....
```

`salt -L 'node01.srv.world,node02.srv.world' status.loadavg` # 使用列表指定某些Minion（以逗号分隔），`status.loadavg`表示确认平均负载

```
node02.srv.world:
    ----------
    1-min:
        0.0
    15-min:
        0.05
    5-min:
        0.01
node01.srv.world:
.....
.....
```

`salt -E 'node[0-9][0-9].srv.world' selinux.getenforce` # 用表达式指定Minion（示例表示`node00-99.srv.world`），`selinux.getenforce`表示确认SELinux运行模式

```
node02.srv.world:
    Enforcing
node01.srv.world:
    Enforcing
```








#### 附1.8.1.3. 

#### 附1.8.1.4. 

#### 附1.8.1.5. 


### 附1.8.2. Puppet

[Puppet](https://puppet.com/)是一个配置管理工具。


















### 附1.8.3. Ansible

[Ansible](https://www.ansible.com/)提供一种最简单的方式用于发布、管理和编排计算机系统的工具。













